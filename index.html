<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>FitEngine Pro AI Demo</title>

<!-- Tailwind para diseño -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Chart.js para gráficas -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>

/* Animación fade cuando aparecen cosas */
.fade {
  animation: fade .4s ease;
}

/* Keyframes de la animación */
@keyframes fade {
  from {opacity:0; transform:translateY(10px);}
  to {opacity:1;}
}

/* Para los details */
details summary {
  cursor:pointer;
}

/* Cuando está abierto, se pone amarillo */
details[open] summary {
  color:#eab308;
}

/* ===== TUTORIAL UI ===== */

/* Fondo negro borroso */
.tutorial-overlay {
  position: fixed; /* se pega a toda la pantalla */
  inset: 0; /* top right bottom left = 0 */
  background: rgba(0,0,0,0.7); /* oscuro */
  backdrop-filter: blur(8px); /* blur fancy */
  z-index: 9999; /* arriba de todo */
  display: flex;
  align-items: center;
  justify-content: center;
  padding: 15px; /* IMPORTANTE para celular */
}

/* Caja del tutorial */
.tutorial-box {
  background: #020617;
  border: 1px solid #eab308;
  padding: 16px;
  border-radius: 16px;
  width: 100%;
  max-width: 380px; /* móvil friendly */
  animation: fade .3s ease;
}

/* Cuando resaltamos algo */
.highlight {
  position: relative;
  z-index: 10000;
  box-shadow: 0 0 0 4px rgba(234,179,8,0.8);
  border-radius: 8px;
}

/* Ajustes SOLO para celular */
@media (max-width: 480px) {
  .tutorial-box {
    font-size: 14px;
  }
}

</style>
</head>

<body class="bg-slate-950 text-slate-200 font-sans pb-10">

<!-- ===== NAV ===== -->
<nav class="p-5 bg-slate-900 border-b border-slate-800 flex justify-between sticky top-0 z-50">
<h1 class="text-2xl font-black text-yellow-500">
  FIT<span class="text-white">ENGINE</span>
</h1>

<div class="flex gap-3 items-center">
<div class="text-xs bg-yellow-500/10 border border-yellow-500/50 px-3 py-1 rounded-full text-yellow-500 font-bold">
AI SIMULATION MODE
</div>

<!-- Botón tutorial -->
<button onclick="startTutorial()" class="text-xs text-yellow-500 underline">
Ver tutorial
</button>
</div>
</nav>

<main class="max-w-6xl mx-auto p-4 space-y-6">

<!-- ================= PANEL DE INPUT ================= -->
<section id="inputPanel" class="bg-slate-900 p-6 rounded-2xl border border-slate-800">
<h2 class="text-xl font-bold mb-4">Variables de Rendimiento</h2>

<div class="grid md:grid-cols-4 gap-4">

<!-- Peso -->
<div id="pesoBox">
<label class="text-xs text-slate-400">Carga</label>
<div class="flex">
<input id="peso" type="number" class="w-full bg-slate-950 border border-slate-700 p-2 rounded-l-lg">
<select id="unit" class="bg-slate-800 border border-slate-700 px-2 rounded-r-lg text-yellow-500 font-bold">
<option value="lbs">LBS</option>
<option value="kg">KG</option>
</select>
</div>
</div>

<!-- Repeticiones -->
<div id="repsBox">
<label class="text-xs text-slate-400">Reps</label>
<input id="reps" type="number" min="1" max="15" class="w-full bg-slate-950 border border-slate-700 p-2 rounded-lg">
</div>

<!-- RPE -->
<div id="rpeBox">
<label class="text-xs text-slate-400">RPE (1-10)</label>
<input id="rpe" type="number" min="1" max="10" class="w-full bg-slate-950 border border-slate-700 p-2 rounded-lg">
</div>

<!-- Botón analizar -->
<div class="flex items-end">
<button onclick="procesar()" class="w-full bg-yellow-500 text-black font-black py-3 rounded-lg">
ANALIZAR
</button>
</div>

</div>

<!-- Botones convertir todo -->
<div class="mt-4 flex gap-2">
<button onclick="convertirTodo('kg')" class="bg-green-600 px-3 py-1 rounded text-xs">Convertir todo a KG</button>
<button onclick="convertirTodo('lbs')" class="bg-blue-600 px-3 py-1 rounded text-xs">Convertir todo a LBS</button>
</div>

<!-- RESULTADOS -->
<div id="resultado" class="mt-6 grid md:grid-cols-4 gap-4 hidden fade">

<div class="bg-slate-950 p-4 rounded-lg border border-yellow-500/20">
<p class="text-xs text-slate-500">1RM</p>
<h3 id="valor1rm" class="text-xl font-black"></h3>
</div>

<div class="bg-slate-950 p-4 rounded-lg border border-blue-500/20">
<p class="text-xs text-slate-500">RIR</p>
<h3 id="valorRir" class="text-xl font-black text-blue-400"></h3>
</div>

<div class="bg-slate-950 p-4 rounded-lg border border-green-500/20">
<p class="text-xs text-slate-500">Siguiente sesión</p>
<h3 id="prediccion" class="text-xl font-black text-green-400"></h3>
</div>

<div class="bg-slate-950 p-4 rounded-lg border border-purple-500/20">
<p class="text-xs text-slate-500">Meta 1 mes</p>
<h3 id="metaMes" class="text-xl font-black text-purple-400"></h3>
</div>

</div>

<!-- Barra score -->
<div class="mt-4">
<p class="text-xs font-bold">Fitness Score</p>
<div class="bg-slate-800 h-2 rounded">
<div id="scoreBar" class="bg-green-500 h-2 rounded transition-all"></div>
</div>
</div>

<!-- Panel IA -->
<div id="aiPanel" class="mt-4 bg-slate-950 border border-cyan-500/30 p-3 rounded text-cyan-400 text-sm"></div>

</section>

<!-- ================= DEFINICIONES ================= -->
<section class="bg-slate-900 p-5 rounded-2xl border border-slate-800">
<h2 class="font-bold text-lg mb-2">Definiciones Técnicas</h2>

<details class="mb-2">
<summary class="font-bold text-yellow-500">¿Qué es 1RM?</summary>
<p class="text-xs mt-2 text-slate-400">
One Rep Max = peso máximo estimado para una repetición.
</p>
</details>

<details class="mb-2">
<summary class="font-bold text-yellow-500">¿Qué es RPE y RIR?</summary>
<p class="text-xs mt-2 text-slate-400">
RPE = qué tan duro se sintió.  
RIR = cuántas reps te quedaron en reserva.
</p>
</details>

<details>
<summary class="font-bold text-yellow-500">Algoritmo de Carga</summary>
<p class="text-xs mt-2 text-slate-400">
Sistema que sube o baja peso automático según rendimiento.
</p>
</details>

</section>

<!-- ================= GRAFICA ================= -->
<section class="bg-slate-900 p-6 rounded-2xl border border-slate-800">
<h2 class="font-bold mb-2">Proyección Mensual</h2>
<div class="h-64">
<canvas id="myChart"></canvas>
</div>
</section>

<!-- ================= CALCULADORA ================= -->
<section class="bg-slate-900 p-6 rounded-2xl border border-slate-800">
<h2 class="font-bold mb-3">Calculadora LBS ↔ KG</h2>

<div class="flex gap-2">
<input id="calcInput" type="number" class="bg-slate-950 border border-slate-700 p-2 rounded w-full">
<select id="calcUnit" class="bg-slate-800 p-2 rounded">
<option value="lbs">LBS</option>
<option value="kg">KG</option>
</select>
<button onclick="convertCalc()" class="bg-yellow-500 text-black px-3 rounded font-bold">
Convertir
</button>
</div>

<p id="calcResult" class="mt-2 text-green-400 font-bold"></p>

</section>

</main>

<!-- ================= TUTORIAL ================= -->
<div id="tutorial" class="hidden tutorial-overlay">
  <div class="tutorial-box">
    <h3 id="tTitle" class="font-black text-yellow-500 text-lg"></h3>
    <p id="tText" class="text-sm text-slate-400 mt-2"></p>
    <button onclick="nextStep()" class="mt-3 bg-yellow-500 text-black px-3 py-1 rounded font-bold w-full">
      Siguiente
    </button>
  </div>
</div>

<script>

// ===== VARIABLES GLOBALES =====
let myChart; // grafica global

// ===== FUNCION CONVERTIR KG/LBS =====
function convert(p, from, to){
  if(from === to) return p; // si es misma unidad no hace nada
  return to === "kg" ? p / 2.20462 : p * 2.20462; // formula conversión
}

// ===== MOTOR PRINCIPAL =====
function procesar(){

  // agarrar valores del input
  let peso = parseFloat(pesoInput.value);
  let reps = parseInt(repsInput.value);
  let rpe  = parseFloat(rpeInput.value);
  let unit = unitInput.value;

  // validación
  if(!peso || !reps || !rpe) return alert("Completa todo loco");
  if(rpe < 1 || rpe > 10) return alert("RPE es del 1 al 10");

  // convertir todo a lbs internamente
  let pesoLbs = convert(peso, unit, "lbs");

  // fórmula 1RM (Epley)
  let oneRM = pesoLbs / (1.0278 - 0.0278 * reps);

  // RIR = reps en reserva
  let rir = 10 - rpe;

  // factor de progresión automática
  let factor = 1.02;
  if(rir >= 4) factor = 1.05; // muy fácil
  if(rir <= 0) factor = 0.95; // muy pesado

  // simulación 4 semanas
  let datos = [pesoLbs];
  let actual = pesoLbs;
  for(let i=1;i<=4;i++){
    actual *= factor;
    datos.push(actual);
  }

  // fitness score random inteligente
  let score = Math.min(100, Math.round((oneRM/pesoLbs*50) + (reps*2) - (rpe*3)));
  scoreBar.style.width = score + "%";

  // mostrar resultados convertidos
  valor1rm.innerText = Math.round(convert(oneRM,"lbs",unit))+" "+unit;
  valorRir.innerText = rir;
  prediccion.innerText = Math.round(convert(datos[1],"lbs",unit))+" "+unit;
  metaMes.innerText = Math.round(convert(datos[4],"lbs",unit))+" "+unit;

  resultado.classList.remove("hidden"); // mostrar panel

  actualizarGrafica(datos, unit); // gráfica
  generarIA(score, rir); // IA fake
}

// ===== CODIGO IA SIMULADA =====
function generarIA(score, rir){
  let msg = "";

  if(score > 80) msg = "Vas duro. Sigue así.";
  else if(score > 50) msg = "Vas bien, pero puedes subir volumen.";
  else msg = "Progreso flojo. Duerme y come mejor.";

  if(rir <= 0) msg += " Estás al fallo.";
  if(rir >= 4) msg += " Puedes subir peso.";

  aiPanel.innerHTML = "AI Coach: " + msg;
}
// ===== FIN CODIGO IA SIMULADA =====

// ===== GRAFICA =====
function actualizarGrafica(datos, unit){
  const ctx = myChartCanvas.getContext("2d");
  if(myChart) myChart.destroy();

  myChart = new Chart(ctx, {
    type:"line",
    data:{
      labels:["Hoy","S1","S2","S3","S4"],
      datasets:[{
        data: datos.map(d=>convert(d,"lbs",unit)),
        borderColor:"#eab308",
        backgroundColor:"rgba(234,179,8,0.1)",
        fill:true,
        tension:0.4
      }]
    },
    options:{responsive:true, plugins:{legend:{display:false}}}
  });
}

// ===== CONVERTIR TODO =====
function convertirTodo(target){
  let peso = parseFloat(pesoInput.value);
  if(!peso) return;
  let newPeso = convert(peso, unitInput.value, target);
  pesoInput.value = newPeso.toFixed(2);
  unitInput.value = target;
  procesar();
}

// ===== CALCULADORA =====
function convertCalc(){
  let v = parseFloat(calcInput.value);
  if(!v) return;
  let u = calcUnit.value;
  let result = u==="lbs" ? convert(v,"lbs","kg") : convert(v,"kg","lbs");
  calcResult.innerText = "Resultado: " + result.toFixed(2) + " " + (u==="lbs"?"KG":"LBS");
}

// ===== REFERENCIAS DOM =====
const pesoInput = peso;
const repsInput = reps;
const rpeInput  = rpe;
const unitInput = unit;
const resultado = document.getElementById("resultado");
const valor1rm  = document.getElementById("valor1rm");
const valorRir  = document.getElementById("valorRir");
const prediccion= document.getElementById("prediccion");
const metaMes   = document.getElementById("metaMes");
const scoreBar  = document.getElementById("scoreBar");
const aiPanel   = document.getElementById("aiPanel");
const myChartCanvas = document.getElementById("myChart");

// ===== SISTEMA TUTORIAL =====
const steps = [
 {el:pesoBox, title:"Carga", text:"Pon el peso que levantaste."},
 {el:repsBox, title:"Repeticiones", text:"Cuántas reps hiciste."},
 {el:rpeBox, title:"RPE", text:"Qué tan duro fue del 1 al 10."},
 {el:resultado, title:"Resultados", text:"Aquí salen las métricas."},
 {el:aiPanel, title:"AI Coach", text:"IA falsa que te da consejos."}
];

let stepIndex = 0;

function startTutorial(){
  tutorial.classList.remove("hidden");
  stepIndex = 0;
  showStep();
}

function showStep(){
  document.querySelectorAll(".highlight").forEach(e=>e.classList.remove("highlight"));
  let step = steps[stepIndex];
  if(!step) return endTutorial();
  step.el.classList.add("highlight");
  tTitle.innerText = step.title;
  tText.innerText = step.text;
}

function nextStep(){
  stepIndex++;
  showStep();
}

function endTutorial(){
  tutorial.classList.add("hidden");
  document.querySelectorAll(".highlight").forEach(e=>e.classList.remove("highlight"));
}

// Tutorial automático primera vez
window.onload = ()=>{
  actualizarGrafica([0,0,0,0,0],"lbs");
  if(!localStorage.getItem("fitTutorial")){
    startTutorial();
    localStorage.setItem("fitTutorial", true);
  }
};

</script>

</body>
</html>
