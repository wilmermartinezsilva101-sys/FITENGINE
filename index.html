<!DOCTYPE html> <!-- Documento HTML5 -->
<html lang="es"> <!-- Idioma español -->
<head>
<meta charset="UTF-8"> <!-- Soporte de acentos y ñ -->
<meta name="viewport" content="width=device-width, initial-scale=1.0"> <!-- Responsive en celular -->
<title>FitEngine Pro AI Demo</title> <!-- Título del navegador -->

<!-- Tailwind CSS para estilos rápidos sin escribir CSS pesado -->
<script src="https://cdn.tailwindcss.com"></script>

<!-- Chart.js para gráficas -->
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
/* Animación suave cuando aparece algo */
.fade {animation:fade .4s ease;}
@keyframes fade{
  from{opacity:0;transform:translateY(10px);}
  to{opacity:1;}
}

/* Cursor clickeable en definiciones */
details summary {cursor:pointer;}
details[open] summary {color:#eab308;}

/* ===== Overlay del tutorial (pantalla oscura) ===== */
.tutorial-overlay {
  position: fixed; /* Se queda fijo en pantalla */
  inset: 0; /* Ocupa toda la pantalla */
  background: rgba(0,0,0,0.7); /* Fondo oscuro */
  backdrop-filter: blur(8px); /* Blur bonito */
  z-index: 9999; /* Encima de todo */
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Caja del tutorial */
.tutorial-box {
  background: #020617; /* Fondo oscuro */
  border: 1px solid #eab308; /* Borde amarillo */
  padding: 20px;
  border-radius: 16px;
  max-width: 340px;
  animation: fade .3s ease;
}

/* Highlight sin romper iPhone */
.highlight {
  outline: 4px solid rgba(234,179,8,0.8); /* Marco amarillo */
  outline-offset: 4px; /* Separación del marco */
  border-radius: 8px;
}

/* Bloquear inputs durante tutorial (iPhone fix) */
body.tutorial-active input,
body.tutorial-active select,
body.tutorial-active button {
  pointer-events: none;
}

/* Fix iOS viewport bug */
html, body {
  height: 100%;
  overscroll-behavior: none;
}
</style>
</head>

<body class="bg-slate-950 text-slate-200 font-sans pb-10"> <!-- Fondo oscuro global -->

<!-- NAV SUPERIOR -->
<nav class="p-5 bg-slate-900 border-b border-slate-800 flex justify-between sticky top-0 z-50">
<h1 class="text-2xl font-black text-yellow-500">FIT<span class="text-white">ENGINE</span></h1> <!-- Logo -->

<div class="flex gap-3 items-center">
<div class="text-xs bg-yellow-500/10 border border-yellow-500/50 px-3 py-1 rounded-full text-yellow-500 font-bold">
AI SIMULATION MODE
</div>

<!-- Botón para iniciar tutorial -->
<button onclick="startTutorial()" class="text-xs text-yellow-500 underline">
Ver tutorial
</button>
</div>
</nav>

<main class="max-w-6xl mx-auto p-4 space-y-6">

<!-- PANEL DE INPUTS -->
<section id="inputPanel" class="bg-slate-900 p-6 rounded-2xl border border-slate-800">
<h2 class="text-xl font-bold mb-4">Variables de Rendimiento</h2>

<div class="grid md:grid-cols-4 gap-4">

<!-- PESO -->
<div id="pesoBox">
<label class="text-xs text-slate-400">Carga</label>
<div class="flex">
<input id="peso" type="number" class="w-full bg-slate-950 border border-slate-700 p-2 rounded-l-lg"> <!-- Peso -->
<select id="unit" class="bg-slate-800 border border-slate-700 px-2 rounded-r-lg text-yellow-500 font-bold">
<option value="lbs">LBS</option>
<option value="kg">KG</option>
</select>
</div>
</div>

<!-- REPETICIONES -->
<div id="repsBox">
<label class="text-xs text-slate-400">Reps</label>
<input id="reps" type="number" min="1" max="15" class="w-full bg-slate-950 border border-slate-700 p-2 rounded-lg">
</div>

<!-- RPE -->
<div id="rpeBox">
<label class="text-xs text-slate-400">RPE (1-10)</label>
<input id="rpe" type="number" min="1" max="10" class="w-full bg-slate-950 border border-slate-700 p-2 rounded-lg">
</div>

<!-- BOTÓN ANALIZAR -->
<div class="flex items-end">
<button onclick="procesar()" class="w-full bg-yellow-500 text-black font-black py-3 rounded-lg">
ANALIZAR
</button>
</div>

</div>

<!-- BOTONES CONVERTIR -->
<div class="mt-4 flex gap-2">
<button onclick="convertirTodo('kg')" class="bg-green-600 px-3 py-1 rounded text-xs">Convertir todo a KG</button>
<button onclick="convertirTodo('lbs')" class="bg-blue-600 px-3 py-1 rounded text-xs">Convertir todo a LBS</button>
</div>

<!-- RESULTADOS -->
<div id="resultado" class="mt-6 grid md:grid-cols-4 gap-4 hidden fade">

<div class="bg-slate-950 p-4 rounded-lg border border-yellow-500/20">
<p class="text-xs text-slate-500">1RM</p>
<h3 id="valor1rm" class="text-xl font-black"></h3>
</div>

<div class="bg-slate-950 p-4 rounded-lg border border-blue-500/20">
<p class="text-xs text-slate-500">RIR</p>
<h3 id="valorRir" class="text-xl font-black text-blue-400"></h3>
</div>

<div class="bg-slate-950 p-4 rounded-lg border border-green-500/20">
<p class="text-xs text-slate-500">Siguiente sesión</p>
<h3 id="prediccion" class="text-xl font-black text-green-400"></h3>
</div>

<div class="bg-slate-950 p-4 rounded-lg border border-purple-500/20">
<p class="text-xs text-slate-500">Meta 1 mes</p>
<h3 id="metaMes" class="text-xl font-black text-purple-400"></h3>
</div>

</div>

<!-- FITNESS SCORE -->
<div class="mt-4">
<p class="text-xs font-bold">Fitness Score</p>
<div class="bg-slate-800 h-2 rounded">
<div id="scoreBar" class="bg-green-500 h-2 rounded transition-all"></div> <!-- Barra dinámica -->
</div>
</div>

<!-- PANEL IA -->
<div id="aiPanel" class="mt-4 bg-slate-950 border border-cyan-500/30 p-3 rounded text-cyan-400 text-sm"></div>

</section>

<!-- GRAFICA -->
<section class="bg-slate-900 p-6 rounded-2xl border border-slate-800">
<h2 class="font-bold mb-2">Proyección Mensual</h2>
<div class="h-64">
<canvas id="myChart"></canvas>
</div>
</section>

</main>

<!-- POPUP DEL TUTORIAL -->
<div id="tutorial" class="hidden tutorial-overlay">
  <div class="tutorial-box" id="tutorialBox">
    <h3 id="tTitle" class="font-black text-yellow-500 text-lg"></h3>
    <p id="tText" class="text-sm text-slate-400 mt-2"></p>
    <button onclick="nextStep()" class="mt-3 bg-yellow-500 text-black px-3 py-1 rounded font-bold w-full">
      Siguiente
    </button>
  </div>
</div>

<script>
// ================== VARIABLES GLOBALES ==================
let myChart; // Guarda la gráfica

// ================== CONVERTIR KG <-> LBS ==================
function convert(p, from, to){
 if(from===to) return p; // Si es misma unidad, no cambia
 return to==="kg" ? p/2.20462 : p*2.20462; // Fórmula real
}

// ================== MOTOR PRINCIPAL ==================
function procesar(){
 let peso=parseFloat(pesoInput.value); // Peso del usuario
 let reps=parseInt(repsInput.value); // Repeticiones
 let rpe=parseFloat(rpeInput.value); // Esfuerzo
 let unit=unitInput.value; // Unidad

 if(!peso||!reps||!rpe) return alert("Completa todo"); // Validación
 if(rpe<1||rpe>10) return alert("RPE 1-10"); // Rango válido

 let pesoLbs=convert(peso,unit,"lbs"); // Convertir a lbs interno
 let oneRM=pesoLbs/(1.0278-0.0278*reps); // Fórmula 1RM
 let rir=10-rpe; // RIR = reps reserva

 let factor=1.02; // Factor progreso base
 if(rir>=4) factor=1.05; // Si muy fácil, subir más
 if(rir<=0) factor=0.95; // Si fallo, bajar

 let datos=[pesoLbs]; // Array gráfico
 let actual=pesoLbs;
 for(let i=1;i<=4;i++){actual*=factor;datos.push(actual);} // 4 semanas

 let score=Math.min(100,Math.round((oneRM/pesoLbs*50)+(reps*2)-(rpe*3))); // Fitness Score
 scoreBar.style.width=score+"%"; // Barra score

 valor1rm.innerText=Math.round(convert(oneRM,"lbs",unit))+" "+unit; // Mostrar 1RM
 valorRir.innerText=rir; // Mostrar RIR
 prediccion.innerText=Math.round(convert(datos[1],"lbs",unit))+" "+unit; // Próxima sesión
 metaMes.innerText=Math.round(convert(datos[4],"lbs",unit))+" "+unit; // Meta mensual

 resultado.classList.remove("hidden"); // Mostrar panel

 actualizarGrafica(datos,unit); // Actualizar chart
 generarIA(score,rir); // AI Coach
}

// ================== IA SIMULADA ==================
function generarIA(score, rir){
 let msg="";
 if(score>80) msg="Vas duro, sigue así.";
 else if(score>50) msg="Buen progreso, puedes subir volumen.";
 else msg="Vas flojo, duerme y come más.";

 if(rir<=0) msg+=" Estás cerca del fallo.";
 if(rir>=4) msg+=" Sube peso la próxima.";

 aiPanel.innerHTML="AI Coach: "+msg; // Mostrar IA
}

// ================== GRAFICA ==================
function actualizarGrafica(datos,unit){
 const ctx=myChartCanvas.getContext("2d"); // Canvas
 if(myChart) myChart.destroy(); // Borrar vieja
 myChart=new Chart(ctx,{
 type:"line",
 data:{
 labels:["Hoy","S1","S2","S3","S4"],
 datasets:[{
 data:datos.map(d=>convert(d,"lbs",unit)),
 borderColor:"#eab308",
 backgroundColor:"rgba(234,179,8,0.1)",
 fill:true,
 tension:0.4
 }]
 },
 options:{responsive:true,plugins:{legend:{display:false}}}
 });
}

// ================== CONVERTIR TODO ==================
function convertirTodo(target){
 let peso=parseFloat(pesoInput.value);
 if(!peso) return;
 let newPeso=convert(peso,unitInput.value,target);
 pesoInput.value=newPeso.toFixed(2);
 unitInput.value=target;
 procesar();
}

// ================== VARIABLES DOM ==================
const pesoInput=peso;
const repsInput=reps;
const rpeInput=rpe;
const unitInput=unit;
const resultado=document.getElementById("resultado");
const valor1rm=document.getElementById("valor1rm");
const valorRir=document.getElementById("valorRir");
const prediccion=document.getElementById("prediccion");
const metaMes=document.getElementById("metaMes");
const scoreBar=document.getElementById("scoreBar");
const aiPanel=document.getElementById("aiPanel");
const myChartCanvas=document.getElementById("myChart");

// ================== TUTORIAL ==================
const steps = [
 {el:pesoBox,title:"Carga",text:"Pon el peso que levantaste."},
 {el:repsBox,title:"Reps",text:"Cuántas repeticiones hiciste."},
 {el:rpeBox,title:"RPE",text:"Qué tan duro fue del 1 al 10."},
 {el:resultado,title:"Resultados",text:"Aquí salen los cálculos."},
 {el:aiPanel,title:"AI Coach",text:"Consejos automáticos."}
];

let stepIndex=0;

// Iniciar tutorial
function startTutorial(){
 document.body.classList.add("tutorial-active"); // Bloquear inputs
 tutorial.classList.remove("hidden");
 stepIndex=0;
 showStep();
}

// Mostrar paso
function showStep(){
 document.querySelectorAll(".highlight").forEach(e=>e.classList.remove("highlight"));
 let step=steps[stepIndex];
 if(!step) return endTutorial();

 step.el.classList.add("highlight"); // Resaltar elemento

 step.el.scrollIntoView({behavior:"smooth", block:"center"}); // iPhone FIX

 tTitle.innerText=step.title; // Título popup
 tText.innerText=step.text; // Texto popup
}

// Siguiente paso
function nextStep(){stepIndex++;showStep();}

// Terminar tutorial
function endTutorial(){
 document.body.classList.remove("tutorial-active"); // Volver normal
 tutorial.classList.add("hidden");
 document.querySelectorAll(".highlight").forEach(e=>e.classList.remove("highlight"));
}

// ================== AUTO START PRIMERA VEZ ==================
window.onload=()=>{
 actualizarGrafica([0,0,0,0,0],"lbs"); // Gráfica vacía
 if(!localStorage.getItem("fitTutorial")){
   startTutorial(); // Mostrar tutorial solo 1 vez
   localStorage.setItem("fitTutorial",true);
 }
};
</script>

</body>
</html>
